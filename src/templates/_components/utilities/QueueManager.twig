<div id="queue-manager-utility">
    <div v-if="loading">
        <div class="center">
            <div class="spinner big"></div>
            <p>Loading</p>
        </div>
    </div>
    <div v-else>

        <div>
        <div class="right" v-if="jobs && !activeJob">
            <a class="btn submit" @click="retryAll">
                Retry all
            </a>

            <a class="btn submit" @click="releaseAll">
                Release all
            </a>
        </div>
        </div>

        <table class="data fullwidth collapsible" v-if="jobs && !activeJob">
            <thead>

            <tr>
                <th scope="col">Job</th>
                <th scope="col">Progress</th>
                <th scope="col">Status</th>
            </tr>
            </thead>
            <tbody>
                <tr v-for="job in jobs">
                    <th><a>[[job.description]]</a></th>
                    <td><code>[[job.progress]]/ 100</code></td>
                    <td>
                        <div>[[jobStatusDeterminer(job)]]</div>
                    </td>
                    <td><a class="btn" @click="retryJob(job)">Retry</a> </td>
                    <td><a class="btn" @click="releaseJob(job)">Cancel</a> </td>
                    <td><a class="btn" @click="setActiveJob(job)">View details</a> </td>
                </tr>
            </tbody>
        </table>
        <div v-else-if="activeJob">
            <h2>[[activeJob.description]]</h2>
            <p v-if="activeJob.error" class="error">[[activeJob.error]]</p>

            <table class="data fullwidth collapsible">
                <thead>
                <tr>
                    <th scope="col">Progress</th>
                    <th scope="col">TTR</th>
                    <th scope="col">Status</th>
                    <th scope="col">Time pushed</th>
                    <th scope="col">Time updated</th>
                    <th scope="col">Date failed</th>
                    <th scope="col">Priority</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td><code>[[activeJob.progress]]/ 100</code></td>
                    <td><code>[[activeJob.ttr]]</code></td>
                    <td>
                        <div>[[jobStatusDeterminer(activeJob)]]</div>
                    </td>
                    <td><code>[[activeJob.timePushed]]</code></td>
                    <td><code>[[activeJob.timeUpdated]]</code></td>
                    <td><code>[[activeJob.dateFailed]]</code></td>
                    <td><code>[[activeJob.priority]]</code></td>
                    <td><a class="btn" @click="retryJob(activeJob)">Retry</a> </td>
                    <td><a class="btn" @click="releaseJob(activeJob)">Cancel</a> </td>
                </tr>
                </tbody>
            </table>

            <hr>

            <h2>Job data:</h2>

            <!-- TODO: Remove inline styles -->
            <div style="background-color: #22292f;color: #38c172; padding: 20px;">
                <code>[[activeJob.job]]</code>
            </div>
            <hr>

            <a @click="resetActiveJob">
                Back to index
            </a>
        </div>
        <div v-else>
            No open jobs
        </div>

    </div>
</div>
