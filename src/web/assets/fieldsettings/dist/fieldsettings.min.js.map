{"version":3,"sources":["fieldsettings/src/fieldsettings.js"],"names":["$","Craft","FieldSettingsToggle","Garnish","Base","extend","$toggle","$container","namespace","currentType","_cancelToken","_ignoreFailedRequest","init","toggle","container","settings","this","val","addListener","handleToggleChange","cancel","requestAnimationFrame","children","detach","appendTo","html","data","replace","response","token","initUiElements","appendHeadHtml","headHtml","settingsHtml","appendFootHtml","footHtml","catch","displayError","cp","t","jQuery"],"mappings":"CAAA,SAACA,GAEGC,MAAAC,oBAAAC,QAAAC,KAAAC,OAAA,CACMH,QAAAA,KACFI,WAD4C,KAE5CC,UAAY,KACZC,YAH4C,KAI5CC,SAAa,KAGbC,aAP4C,KAQ5CC,sBAAsB,EAGlBC,KAAKN,SAAYO,EAAjBC,EAAAN,GACKD,KAAAA,QAAeO,EAAAA,GACfN,KAAAA,WAAYA,EAAjBM,GACKL,KAAAA,UAAcD,EACdO,KAAAA,YAALC,KAAAV,QAAAW,MACKC,KAAAA,SAAiBZ,GAhBkBU,KAAAE,YAAAF,KAAAV,QAAA,SAAA,uBAqBxCa,mBAAA,WAcI,GAdAH,KAAKN,eAEAA,KAAAA,sBAAL,EAAAM,KAAKN,aAAaU,SACVC,QAAAA,sBAA4B,KAC3BV,KAAAA,sBAAL,KAKHI,KAAAA,SAAcN,KAAAA,aAAoBF,KAAAA,WAAWe,WAAhBC,SAElCP,KAAKP,YAAcO,KAAKV,QAAQW,WAGkBV,IAAhCS,KAAKP,SAAAA,KAAae,aAIpC,YAHIR,KAAAD,SAAAC,KAAAP,aAAAe,SAAAR,KAAAT,YAIJS,KAAKT,WAAWkB,KAAK,wDAMbT,KAAEN,aAAKD,MAAAA,YAAAA,SADf,IAAIiB,EAAO,CAGFlB,KAAAA,KAAWC,aAEnBO,KAAAR,YADGkB,EAAKlB,UAAYQ,KAAKR,UAAUmB,QAAQ,YAAaX,KAAKP,cAKtDR,MAAEyB,kBAAAA,OAAAA,yBAAAA,CACFE,YAAYZ,KAAAN,aAAAmB,MACXtB,KAAAA,IACCuB,KAAAA,IACAC,KAAAA,WAAeH,KAAQA,EAAMI,KAAnCC,cAAA,IACMC,MAAAA,eAAuBlB,KAART,YAChBN,MAAM8B,eAAAH,EAAAF,KAAAM,UACN/B,MAAKU,eAAAA,EAAsBe,KAAAS,YACvBC,MAAIC,KACZrB,KAAAL,sBAXLV,MAAAqC,GAAAD,aAAApC,MAAAsC,EAAA,MAAA,kCAvDZ,CAsEGC","file":"fieldsettings.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    Craft.FieldSettingsToggle = Garnish.Base.extend({\n        $toggle: null,\n        $container: null,\n        namespace: null,\n        currentType: null,\n        settings: null,\n\n        _cancelToken: null,\n        _ignoreFailedRequest: false,\n\n        init: function(toggle, container, namespace) {\n            this.$toggle = $(toggle);\n            this.$container = $(container);\n            this.namespace = namespace;\n            this.currentType = this.$toggle.val();\n            this.settings = {};\n            this.addListener(this.$toggle, 'change', 'handleToggleChange');\n        },\n\n        handleToggleChange: function() {\n            // Cancel the current request\n            if (this._cancelToken) {\n                this._ignoreFailedRequest = true;\n                this._cancelToken.cancel();\n                Garnish.requestAnimationFrame(() => {\n                    this._ignoreFailedRequest = false;\n                });\n            }\n\n            // Save & detach the current settings\n            this.settings[this.currentType] = this.$container.children().detach();\n\n            this.currentType = this.$toggle.val();\n\n            if (typeof this.settings[this.currentType] !== 'undefined') {\n                this.settings[this.currentType].appendTo(this.$container);\n                return;\n            }\n\n            // Show a spinner\n            this.$container.html('<div class=\"zilch\"><div class=\"spinner\"></div></div>');\n\n            // Create a cancel token\n            this._cancelToken = axios.CancelToken.source();\n\n            let data = {\n                type: this.currentType,\n            };\n            if (this.namespace) {\n                data.namespace = this.namespace.replace(/__TYPE__/g, this.currentType);\n            }\n\n            Craft.sendActionRequest('POST', 'fields/render-settings', {\n                cancelToken: this._cancelToken.token,\n                data: data\n            }).then(response => {\n                this.$container.html(response.data.settingsHtml || '');\n                Craft.initUiElements(this.$container);\n                Craft.appendHeadHtml(response.data.headHtml);\n                Craft.appendFootHtml(response.data.footHtml);\n            }).catch(() => {\n                if (!this._ignoreFailedRequest) {\n                    Craft.cp.displayError(Craft.t('app', 'A server error occurred.'));\n                }\n            });\n        },\n    });\n})(jQuery);\n"]}