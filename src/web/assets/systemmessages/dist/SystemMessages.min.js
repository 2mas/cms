!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var s,i,a,r;n(1);s=jQuery,i=Garnish.Base.extend({messages:null,init:function(){this.messages=[];for(var e=s("#messages").find(".message"),t=0;t<e.length;t++){var n=new a(e[t]);this.messages.push(n)}}}),a=Garnish.Base.extend({$container:null,key:null,$subject:null,$body:null,modal:null,init:function(e){this.$container=s(e),this.key=this.$container.attr("data-key"),this.$subject=this.$container.find(".subject:first"),this.$body=this.$container.find(".body:first"),this.addListener(this.$container,"click","edit")},edit:function(){this.modal?this.modal.show():this.modal=new r(this)},updateHtmlFromModal:function(){var e=this.modal.$subjectInput.val(),t=Craft.escapeHtml(this.modal.$bodyInput.val()).replace(/\n/g,"<br>");this.$subject.text(e),this.$body.html(t)}}),r=Garnish.Modal.extend({message:null,$languageSelect:null,$subjectInput:null,$bodyInput:null,$saveBtn:null,$cancelBtn:null,$spinner:null,loading:!1,init:function(e){this.message=e,this.base(null,{resizable:!0}),this.loadContainer()},loadContainer:function(e){var t={key:this.message.key,language:e};void 0!==Craft.csrfTokenName&&void 0!==Craft.csrfTokenValue&&(t[Craft.csrfTokenName]=Craft.csrfTokenValue),Craft.postActionRequest("system-messages/get-message-modal",t,s.proxy((function(e,t){if("success"===t){if(this.$container)this.$container.html(e.body);else{var n=s('<form class="modal fitted message-settings" accept-charset="UTF-8">'+e.body+"</form>").appendTo(Garnish.$bod);this.setContainer(n),this.show()}this.$languageSelect=this.$container.find(".language:first > select"),this.$subjectInput=this.$container.find(".message-subject:first"),this.$bodyInput=this.$container.find(".message-body:first"),this.$saveBtn=this.$container.find(".submit:first"),this.$cancelBtn=this.$container.find(".cancel:first"),this.$spinner=this.$container.find(".spinner:first"),this.addListener(this.$languageSelect,"change","switchLanguage"),this.addListener(this.$container,"submit","saveMessage"),this.addListener(this.$cancelBtn,"click","cancel"),setTimeout(s.proxy((function(){this.$subjectInput.trigger("focus")}),this),100)}}),this))},switchLanguage:function(){this.loadContainer(this.$languageSelect.val())},saveMessage:function(e){if(e.preventDefault(),!this.loading){var t={key:this.message.key,language:this.$languageSelect.length?this.$languageSelect.val():Craft.primarySiteLanguage,subject:this.$subjectInput.val(),body:this.$bodyInput.val()};if(this.$subjectInput.removeClass("error"),this.$bodyInput.removeClass("error"),!t.subject||!t.body)return t.subject||this.$subjectInput.addClass("error"),t.body||this.$bodyInput.addClass("error"),void Garnish.shake(this.$container);this.loading=!0,this.$saveBtn.addClass("active"),this.$spinner.show(),Craft.postActionRequest("system-messages/save-message",t,s.proxy((function(e,n){this.$saveBtn.removeClass("active"),this.$spinner.hide(),this.loading=!1,"success"===n&&(e.success?(t.language===Craft.primarySiteLanguage&&this.message.updateHtmlFromModal(),this.hide(),Craft.cp.displayNotice(Craft.t("app","Message saved."))):Craft.cp.displayError())}),this))}},cancel:function(){this.hide(),this.message&&(this.message.modal=null)}}),new i},function(e,t,n){var s=n(2);"string"==typeof s&&(s=[[e.i,s,""]]),s.locals&&(e.exports=s.locals);(0,n(3).default)("12a04a16",s,!1,{})},function(e,t,n){},function(e,t,n){"use strict";function s(e,t){for(var n=[],s={},i=0;i<t.length;i++){var a=t[i],r=a[0],o={id:e+":"+i,css:a[1],media:a[2],sourceMap:a[3]};s[r]?s[r].parts.push(o):n.push(s[r]={id:r,parts:[o]})}return n}n.r(t),n.d(t,"default",(function(){return h}));var i="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!i)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var a={},r=i&&(document.head||document.getElementsByTagName("head")[0]),o=null,u=0,l=!1,c=function(){},d=null,f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function h(e,t,n,i){l=n,d=i||{};var r=s(e,t);return p(r),function(t){for(var n=[],i=0;i<r.length;i++){var o=r[i];(u=a[o.id]).refs--,n.push(u)}t?p(r=s(e,t)):r=[];for(i=0;i<n.length;i++){var u;if(0===(u=n[i]).refs){for(var l=0;l<u.parts.length;l++)u.parts[l]();delete a[u.id]}}}}function p(e){for(var t=0;t<e.length;t++){var n=e[t],s=a[n.id];if(s){s.refs++;for(var i=0;i<s.parts.length;i++)s.parts[i](n.parts[i]);for(;i<n.parts.length;i++)s.parts.push(m(n.parts[i]));s.parts.length>n.parts.length&&(s.parts.length=n.parts.length)}else{var r=[];for(i=0;i<n.parts.length;i++)r.push(m(n.parts[i]));a[n.id]={id:n.id,refs:1,parts:r}}}}function g(){var e=document.createElement("style");return e.type="text/css",r.appendChild(e),e}function m(e){var t,n,s=document.querySelector('style[data-vue-ssr-id~="'+e.id+'"]');if(s){if(l)return c;s.parentNode.removeChild(s)}if(f){var i=u++;s=o||(o=g()),t=y.bind(null,s,i,!1),n=y.bind(null,s,i,!0)}else s=g(),t=$.bind(null,s),n=function(){s.parentNode.removeChild(s)};return t(e),function(s){if(s){if(s.css===e.css&&s.media===e.media&&s.sourceMap===e.sourceMap)return;t(e=s)}else n()}}var v,b=(v=[],function(e,t){return v[e]=t,v.filter(Boolean).join("\n")});function y(e,t,n,s){var i=n?"":s.css;if(e.styleSheet)e.styleSheet.cssText=b(t,i);else{var a=document.createTextNode(i),r=e.childNodes;r[t]&&e.removeChild(r[t]),r.length?e.insertBefore(a,r[t]):e.appendChild(a)}}function $(e,t){var n=t.css,s=t.media,i=t.sourceMap;if(s&&e.setAttribute("media",s),d.ssrId&&e.setAttribute("data-vue-ssr-id",t.id),i&&(n+="\n/*# sourceURL="+i.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(i))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}}]);
//# sourceMappingURL=SystemMessages.min.js.map