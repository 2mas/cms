{"version":3,"sources":["matrixsettings/src/MatrixConfigurator.js"],"names":["$","Craft","MatrixConfigurator","Garnish","Base","extend","inputNamePrefix","fieldTypeSettingsNamespace","inputIdPrefix","$blockTypesColumnContainer","$fieldSettingsColumnContainer","$blockTypeItemsOuterContainer","$blockTypeItemsContainer","$fieldSettingItemsContainer","$newBlockTypeBtn","$newFieldBtn","blockTypes","blockTypeSort","totalNewBlockTypes","_cancelToken","_ignoreFailedRequest","fieldTypeInfo","$container","$fieldsColumnContainer","children","$fieldItemsOuterContainer","formatInputId","setContainerHeight","this","$item","newMatch","DragSort","i","$blockTypeItems","length","id","addListener","match","Math","height","getFieldTypeInfo","handle","getBlockTypeSettingsModal","blockTypeSettingsModal","onSubmit","proxy","BlockType","applySettings","name","maxColHeight","type","addFieldToSelectedBlockType","selectedBlockType","addField","addBlockType","show","getFieldTypeSettingsHtml","Promise","_fieldTypeSettingsHtml","t","appendTo","CancelToken","sendActionRequest","addItems","then","response","BlockTypeSettingsModal","resolve","reject","cancel","requestAnimationFrame","$handleHeading","axios","$handleInstructions","$handleInputContainer","token","data","namespace","handleGenerator","HandleGenerator","catch","$cancelBtn","$form","$deleteBtn","Modal","init","$bod","$body","hide","$nameField","$nameHeading","$nameLabel","$nameInstructions","onDeleteClick","$nameInputContainer","confirm","$nameErrorList","onDelete","$handleField","$handleLabel","$nameInput","$handleInput","$handleErrorList","startListening","$buttons","stopListening","$submitBtn","onFormSubmit","ev","preventDefault","visible","listening","updateTarget","attr","val","shake","$input","errors","$handleHiddenInput","addClass","removeClass","fieldSettings","displayErrors","configurator","isMobileBrowser","setTimeout","trigger","base","$settingsBtn","find","$errorList","$fieldItemsContainer","remove","$fieldSettingsContainer","text","totalNewFields","fieldSort","onSortChange","field","selectedField","$nameContainer","$nameHiddenInput","insertBefore","fields","$fieldItems","Field","$fieldItem","deselect","$items","$translationSettingsContainer","blockType","initializedFieldTypeSettings","fieldTypeSettingsTemplates","showSettings","$typeSettingsContainer","$widthInput","setFieldType","selectedFieldType","$typeSelect","width","select","selfDestruct","widthSlider","updateNameLabel","escapeHtml","updateHandleLabel","html","updateRequiredIcon","$requiredCheckbox","prop","onTypeSelectChange","updateTranslationMethodSettings","getFieldTypeSettings","getDefaultFieldSettings","footHtml","append","fresh","initUiElements","$settings","appendHeadHtml","headHtml","isNew","SlidePicker","min","step","settingsHtml","getParsedFieldTypeHtml","pct","insertAfter","noop","replace","createTextField","createTextareaField","label","fieldTypeOptions","push","detach","isMultiSite","createSelectField","appendFootHtml","targetPrefix","confirmDelete","data-id","ui","class","maxlength","required","$fieldset","createCheckboxField","checked","value","options","toggle","$translationKeyFormatContainer","jQuery"],"mappings":"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","file":"MatrixConfigurator.min.js","sourcesContent":["(function($) {\n    /** global: Craft */\n    /** global: Garnish */\n    /**\n     * Matrix configurator class\n     */\n    Craft.MatrixConfigurator = Garnish.Base.extend(\n        {\n            fieldTypeInfo: null,\n\n            inputNamePrefix: null,\n            fieldTypeSettingsNamespace: null,\n            inputIdPrefix: null,\n\n            $container: null,\n\n            $blockTypesColumnContainer: null,\n            $fieldsColumnContainer: null,\n            $fieldSettingsColumnContainer: null,\n\n            $blockTypeItemsOuterContainer: null,\n            $blockTypeItemsContainer: null,\n            $fieldItemsContainer: null,\n            $fieldSettingItemsContainer: null,\n\n            $newBlockTypeBtn: null,\n            $newFieldBtn: null,\n\n            blockTypes: null,\n            selectedBlockType: null,\n            blockTypeSort: null,\n            totalNewBlockTypes: 0,\n\n            _fieldTypeSettingsHtml: {},\n            _cancelToken: null,\n            _ignoreFailedRequest: false,\n\n            init: function(fieldTypeInfo, inputNamePrefix, fieldTypeSettingsNamespace) {\n                this.fieldTypeInfo = fieldTypeInfo;\n                this.inputNamePrefix = inputNamePrefix;\n                this.fieldTypeSettingsNamespace = fieldTypeSettingsNamespace;\n                this.inputIdPrefix = Craft.formatInputId(this.inputNamePrefix);\n\n                this.$container = $('#' + this.inputIdPrefix + '-matrix-configurator:first .input:first');\n\n                this.$blockTypesColumnContainer = this.$container.children('.block-types').children();\n                this.$fieldsColumnContainer = this.$container.children('.fields').children();\n                this.$fieldSettingsColumnContainer = this.$container.children('.field-settings').children();\n\n                this.$blockTypeItemsOuterContainer = this.$blockTypesColumnContainer.children('.items');\n                this.$blockTypeItemsContainer = this.$blockTypeItemsOuterContainer.children('.blocktypes');\n                this.$fieldItemsOuterContainer = this.$fieldsColumnContainer.children('.items');\n                this.$fieldSettingItemsContainer = this.$fieldSettingsColumnContainer.children('.items');\n\n                this.setContainerHeight();\n\n                this.$newBlockTypeBtn = this.$blockTypeItemsOuterContainer.children('.btn');\n                this.$newFieldBtn = this.$fieldItemsOuterContainer.children('.btn');\n\n                // Find the existing block types\n                this.blockTypes = {};\n\n                var $blockTypeItems = this.$blockTypeItemsContainer.children();\n\n                for (var i = 0; i < $blockTypeItems.length; i++) {\n                    var $item = $($blockTypeItems[i]),\n                        id = $item.data('id');\n\n                    this.blockTypes[id] = new BlockType(this, $item);\n\n                    // Is this a new block type?\n                    var newMatch = (typeof id === 'string' && id.match(/new(\\d+)/));\n\n                    if (newMatch && newMatch[1] > this.totalNewBlockTypes) {\n                        this.totalNewBlockTypes = parseInt(newMatch[1]);\n                    }\n                }\n\n                this.blockTypeSort = new Garnish.DragSort($blockTypeItems, {\n                    handle: '.move',\n                    axis: 'y'\n                });\n\n                this.addListener(this.$newBlockTypeBtn, 'click', 'addBlockType');\n                this.addListener(this.$newFieldBtn, 'click', 'addFieldToSelectedBlockType');\n\n                this.addListener(this.$blockTypesColumnContainer, 'resize', 'setContainerHeight');\n                this.addListener(this.$fieldsColumnContainer, 'resize', 'setContainerHeight');\n                this.addListener(this.$fieldSettingsColumnContainer, 'resize', 'setContainerHeight');\n            },\n\n            setContainerHeight: function() {\n                setTimeout($.proxy(function() {\n                    var maxColHeight = Math.max(this.$blockTypesColumnContainer.height(), this.$fieldsColumnContainer.height(), this.$fieldSettingsColumnContainer.height(), 400);\n                    this.$container.height(maxColHeight);\n                }, this), 1);\n            },\n\n            getFieldTypeInfo: function(type) {\n                for (var i = 0; i < this.fieldTypeInfo.length; i++) {\n                    if (this.fieldTypeInfo[i].type === type) {\n                        return this.fieldTypeInfo[i];\n                    }\n                }\n            },\n\n            addBlockType: function() {\n                this.getBlockTypeSettingsModal();\n\n                this.blockTypeSettingsModal.show();\n\n                this.blockTypeSettingsModal.onSubmit = $.proxy(function(name, handle) {\n                    this.totalNewBlockTypes++;\n                    var id = 'new' + this.totalNewBlockTypes;\n\n                    var $item = $(\n                        '<div class=\"matrixconfigitem mci-blocktype\" data-id=\"' + id + '\">' +\n                        '<div class=\"mci-name\">' +\n                        '<h4></h4>' +\n                        '<div class=\"smalltext light code\"></div>' +\n                        '</div>' +\n                        '<a class=\"settings icon\" title=\"' + Craft.t('app', 'Settings') + '\"></a>' +\n                        '<a class=\"move icon\" title=\"' + Craft.t('app', 'Reorder') + '\"></a>' +\n                        '<input class=\"hidden\" name=\"types[craft\\\\fields\\\\Matrix][blockTypes][' + id + '][name]\">' +\n                        '<input class=\"hidden\" name=\"types[craft\\\\fields\\\\Matrix][blockTypes][' + id + '][handle]\">' +\n                        '</div>'\n                    ).appendTo(this.$blockTypeItemsContainer);\n\n                    this.blockTypes[id] = new BlockType(this, $item);\n                    this.blockTypes[id].applySettings(name, handle);\n                    this.blockTypes[id].select();\n                    this.blockTypes[id].addField();\n\n                    this.blockTypeSort.addItems($item);\n                }, this);\n            },\n\n            addFieldToSelectedBlockType: function() {\n                if (this.selectedBlockType) {\n                    this.selectedBlockType.addField();\n                }\n            },\n\n            getBlockTypeSettingsModal: function() {\n                if (!this.blockTypeSettingsModal) {\n                    this.blockTypeSettingsModal = new BlockTypeSettingsModal();\n                }\n\n                return this.blockTypeSettingsModal;\n            },\n\n            getFieldTypeSettingsHtml: function(type) {\n                return new Promise((resolve, reject) => {\n                    if (typeof this._fieldTypeSettingsHtml[type] !== 'undefined') {\n                        resolve(this._fieldTypeSettingsHtml[type]);\n                        return;\n                    }\n\n                    // Cancel the current request\n                    if (this._cancelToken) {\n                        this._ignoreFailedRequest = true;\n                        this._cancelToken.cancel();\n                        Garnish.requestAnimationFrame(() => {\n                            this._ignoreFailedRequest = false;\n                        });\n                    }\n\n                    // Create a cancel token\n                    this._cancelToken = axios.CancelToken.source();\n\n                    Craft.sendActionRequest('POST', 'fields/render-settings', {\n                        cancelToken: this._cancelToken.token,\n                        data: {\n                            type: type,\n                            namespace: this.fieldTypeSettingsNamespace,\n                        }\n                    }).then(response => {\n                        this._fieldTypeSettingsHtml[type] = response.data;\n                        resolve(response.data);\n                    }).catch(() => {\n                        if (!this._ignoreFailedRequest) {\n                            Craft.cp.displayError(Craft.t('app', 'A server error occurred.'));\n                        }\n                        reject();\n                    });\n                });\n            },\n        });\n\n\n    /**\n     * Block type settings modal class\n     */\n    var BlockTypeSettingsModal = Garnish.Modal.extend(\n        {\n            init: function() {\n                this.base();\n\n                this.$form = $('<form class=\"modal fitted\"/>').appendTo(Garnish.$bod);\n                this.setContainer(this.$form);\n\n                this.$body = $('<div class=\"body\"/>').appendTo(this.$form);\n                this.$nameField = $('<div class=\"field\"/>').appendTo(this.$body);\n                this.$nameHeading = $('<div class=\"heading\"/>').appendTo(this.$nameField);\n                this.$nameLabel = $('<label for=\"new-block-type-name\">' + Craft.t('app', 'Name') + '</label>').appendTo(this.$nameHeading);\n                this.$nameInstructions = $('<div class=\"instructions\"><p>' + Craft.t('app', 'What this block type will be called in the control panel.') + '</p></div>').appendTo(this.$nameHeading);\n                this.$nameInputContainer = $('<div class=\"input\"/>').appendTo(this.$nameField);\n                this.$nameInput = $('<input type=\"text\" class=\"text fullwidth\" id=\"new-block-type-name\"/>').appendTo(this.$nameInputContainer);\n                this.$nameErrorList = $('<ul class=\"errors\"/>').appendTo(this.$nameInputContainer).hide();\n                this.$handleField = $('<div class=\"field\"/>').appendTo(this.$body);\n                this.$handleHeading = $('<div class=\"heading\"/>').appendTo(this.$handleField);\n                this.$handleLabel = $('<label for=\"new-block-type-handle\">' + Craft.t('app', 'Handle') + '</label>').appendTo(this.$handleHeading);\n                this.$handleInstructions = $('<div class=\"instructions\"><p>' + Craft.t('app', 'How you’ll refer to this block type in the templates.') + '</p></div>').appendTo(this.$handleHeading);\n                this.$handleInputContainer = $('<div class=\"input\"/>').appendTo(this.$handleField);\n                this.$handleInput = $('<input type=\"text\" class=\"text fullwidth code\" id=\"new-block-type-handle\"/>').appendTo(this.$handleInputContainer);\n                this.$handleErrorList = $('<ul class=\"errors\"/>').appendTo(this.$handleInputContainer).hide();\n                this.$deleteBtn = $('<a class=\"error left hidden\" style=\"line-height: 30px;\">' + Craft.t('app', 'Delete') + '</a>').appendTo(this.$body);\n                this.$buttons = $('<div class=\"buttons right\" style=\"margin-top: 0;\"/>').appendTo(this.$body);\n                this.$cancelBtn = $('<div class=\"btn\">' + Craft.t('app', 'Cancel') + '</div>').appendTo(this.$buttons);\n                this.$submitBtn = $('<input type=\"submit\" class=\"btn submit\"/>').appendTo(this.$buttons);\n\n                this.handleGenerator = new Craft.HandleGenerator(this.$nameInput, this.$handleInput);\n\n                this.addListener(this.$cancelBtn, 'click', 'hide');\n                this.addListener(this.$form, 'submit', 'onFormSubmit');\n                this.addListener(this.$deleteBtn, 'click', 'onDeleteClick');\n            },\n\n            onFormSubmit: function(ev) {\n                ev.preventDefault();\n\n                // Prevent multi form submits with the return key\n                if (!this.visible) {\n                    return;\n                }\n\n                if (this.handleGenerator.listening) {\n                    // Give the handle a chance to catch up with the input\n                    this.handleGenerator.updateTarget();\n                }\n\n                // Basic validation\n                var name = Craft.trim(this.$nameInput.val()),\n                    handle = Craft.trim(this.$handleInput.val());\n\n                if (!name || !handle) {\n                    Garnish.shake(this.$form);\n                }\n                else {\n                    this.hide();\n                    this.onSubmit(name, handle);\n                }\n            },\n\n            onDeleteClick: function() {\n                if (confirm(Craft.t('app', 'Are you sure you want to delete this block type?'))) {\n                    this.hide();\n                    this.onDelete();\n                }\n            },\n\n            show: function(name, handle, errors) {\n                this.$nameInput.val(typeof name === 'string' ? name : '');\n                this.$handleInput.val(typeof handle === 'string' ? handle : '');\n\n                if (!handle) {\n                    this.handleGenerator.startListening();\n                }\n                else {\n                    this.handleGenerator.stopListening();\n                }\n\n                if (typeof name === 'undefined') {\n                    this.$deleteBtn.addClass('hidden');\n                    this.$submitBtn.val(Craft.t('app', 'Create'));\n                }\n                else {\n                    this.$deleteBtn.removeClass('hidden');\n                    this.$submitBtn.val(Craft.t('app', 'Save'));\n                }\n\n                this.displayErrors('name', (errors ? errors.name : null));\n                this.displayErrors('handle', (errors ? errors.handle : null));\n\n                if (!Garnish.isMobileBrowser()) {\n                    setTimeout($.proxy(function() {\n                        this.$nameInput.trigger('focus');\n                    }, this), 100);\n                }\n\n                this.base();\n            },\n\n            displayErrors: function(attr, errors) {\n                var $input = this['$' + attr + 'Input'],\n                    $errorList = this['$' + attr + 'ErrorList'];\n\n                $errorList.children().remove();\n\n                if (errors) {\n                    $input.addClass('error');\n                    $errorList.show();\n\n                    for (var i = 0; i < errors.length; i++) {\n                        $('<li/>').text(errors[i]).appendTo($errorList);\n                    }\n                }\n                else {\n                    $input.removeClass('error');\n                    $errorList.hide();\n                }\n            }\n        });\n\n\n    /**\n     * Block type class\n     */\n    var BlockType = Garnish.Base.extend(\n        {\n            configurator: null,\n            id: null,\n            errors: null,\n\n            inputNamePrefix: null,\n            inputIdPrefix: null,\n\n            $item: null,\n            $nameLabel: null,\n            $handleLabel: null,\n            $nameHiddenInput: null,\n            $handleHiddenInput: null,\n            $settingsBtn: null,\n            $fieldItemsContainer: null,\n            $fieldSettingsContainer: null,\n\n            fields: null,\n            selectedField: null,\n            fieldSort: null,\n            totalNewFields: 0,\n            fieldSettings: null,\n\n            init: function(configurator, $item) {\n                this.configurator = configurator;\n                this.$item = $item;\n                this.id = this.$item.data('id');\n                this.errors = this.$item.data('errors');\n\n                this.inputNamePrefix = this.configurator.inputNamePrefix + '[blockTypes][' + this.id + ']';\n                this.inputIdPrefix = this.configurator.inputIdPrefix + '-blockTypes-' + this.id;\n\n                let $nameContainer = this.$item.children('.mci-name');\n                this.$nameLabel = $nameContainer.children('h4');\n                this.$handleLabel = $nameContainer.children('.smalltext');\n                this.$nameHiddenInput = this.$item.find('input[name$=\"[name]\"]:first');\n                this.$handleHiddenInput = this.$item.find('input[name$=\"[handle]\"]:first');\n                this.$settingsBtn = this.$item.find('.settings');\n\n                // Find the field items container if it exists, otherwise create it\n                this.$fieldItemsContainer = this.configurator.$fieldItemsOuterContainer.children('[data-id=\"' + this.id + '\"]:first');\n\n                if (!this.$fieldItemsContainer.length) {\n                    this.$fieldItemsContainer = $('<div data-id=\"' + this.id + '\"/>').insertBefore(this.configurator.$newFieldBtn);\n                }\n\n                // Find the field settings container if it exists, otherwise create it\n                this.$fieldSettingsContainer = this.configurator.$fieldSettingItemsContainer.children('[data-id=\"' + this.id + '\"]:first');\n\n                if (!this.$fieldSettingsContainer.length) {\n                    this.$fieldSettingsContainer = $('<div data-id=\"' + this.id + '\"/>').appendTo(this.configurator.$fieldSettingItemsContainer);\n                }\n\n                // Find the existing fields\n                this.fields = {};\n\n                var $fieldItems = this.$fieldItemsContainer.children();\n\n                for (var i = 0; i < $fieldItems.length; i++) {\n                    var $fieldItem = $($fieldItems[i]),\n                        id = $fieldItem.data('id');\n\n                    this.fields[id] = new Field(this.configurator, this, $fieldItem);\n\n                    // Is this a new field?\n                    var newMatch = (typeof id === 'string' && id.match(/new(\\d+)/));\n\n                    if (newMatch && newMatch[1] > this.totalNewFields) {\n                        this.totalNewFields = parseInt(newMatch[1]);\n                    }\n                }\n\n                this.addListener(this.$item, 'click', 'select');\n                this.addListener(this.$settingsBtn, 'click', 'showSettings');\n\n                this.fieldSort = new Garnish.DragSort($fieldItems, {\n                    handle: '.move',\n                    axis: 'y',\n                    onSortChange: $.proxy(function() {\n                        // Adjust the field setting containers to match the new sort order\n                        for (var i = 0; i < this.fieldSort.$items.length; i++) {\n                            var $item = $(this.fieldSort.$items[i]),\n                                id = $item.data('id'),\n                                field = this.fields[id];\n\n                            field.$fieldSettingsContainer.appendTo(this.$fieldSettingsContainer);\n                        }\n                    }, this)\n                });\n            },\n\n            select: function() {\n                if (this.configurator.selectedBlockType === this) {\n                    return;\n                }\n\n                if (this.configurator.selectedBlockType) {\n                    this.configurator.selectedBlockType.deselect();\n                }\n\n                this.configurator.$fieldsColumnContainer.removeClass('hidden').trigger('resize');\n                this.$fieldItemsContainer.removeClass('hidden');\n                this.$item.addClass('sel');\n                this.configurator.selectedBlockType = this;\n            },\n\n            deselect: function() {\n                this.$item.removeClass('sel');\n                this.configurator.$fieldsColumnContainer.addClass('hidden').trigger('resize');\n                this.$fieldItemsContainer.addClass('hidden');\n                this.$fieldSettingsContainer.addClass('hidden');\n                this.configurator.selectedBlockType = null;\n\n                if (this.selectedField) {\n                    this.selectedField.deselect();\n                }\n            },\n\n            showSettings: function() {\n                var blockTypeSettingsModal = this.configurator.getBlockTypeSettingsModal();\n                blockTypeSettingsModal.show(this.$nameHiddenInput.val(), this.$handleHiddenInput.val(), this.errors);\n                blockTypeSettingsModal.onSubmit = $.proxy(this, 'applySettings');\n                blockTypeSettingsModal.onDelete = $.proxy(this, 'selfDestruct');\n            },\n\n            applySettings: function(name, handle) {\n                if (this.errors) {\n                    this.errors = null;\n                    this.$settingsBtn.removeClass('error');\n                }\n\n                this.$nameLabel.text(name);\n                this.$handleLabel.text(handle);\n                this.$nameHiddenInput.val(name);\n                this.$handleHiddenInput.val(handle);\n            },\n\n            addField: function() {\n                this.totalNewFields++;\n                var id = 'new' + this.totalNewFields;\n\n                var $item = $(\n                    '<div class=\"matrixconfigitem mci-field\" data-id=\"' + id + '\">' +\n                    '<div class=\"mci-name\">' +\n                    '<h4><em class=\"light\">' + Craft.t('app', '(blank)') + '</em></h4>' +\n                    '<div class=\"smalltext light code\"></div>' +\n                    '</div>' +\n                    '<div class=\"actions\">' +\n                    '<a class=\"move icon\" title=\"' + Craft.t('app', 'Reorder') + '\"></a>' +\n                    '</div>' +\n                    '</div>'\n                ).appendTo(this.$fieldItemsContainer);\n\n                this.fields[id] = new Field(this.configurator, this, $item);\n                this.fields[id].select();\n\n                this.fieldSort.addItems($item);\n            },\n\n            selfDestruct: function() {\n                this.deselect();\n                this.$item.remove();\n                this.$fieldItemsContainer.remove();\n                this.$fieldSettingsContainer.remove();\n\n                this.configurator.blockTypes[this.id] = null;\n                delete this.configurator.blockTypes[this.id];\n            }\n        });\n\n\n    var Field = Garnish.Base.extend(\n        {\n            configurator: null,\n            blockType: null,\n            id: null,\n\n            inputNamePrefix: null,\n            inputIdPrefix: null,\n\n            selectedFieldType: null,\n            initializedFieldTypeSettings: null,\n\n            $item: null,\n            $nameLabel: null,\n            $handleLabel: null,\n\n            $fieldSettingsContainer: null,\n            $nameInput: null,\n            $handleInput: null,\n            $requiredCheckbox: null,\n            $typeSelect: null,\n            $translationSettingsContainer: null,\n            $typeSettingsContainer: null,\n            $widthInput: null,\n            $deleteBtn: null,\n\n            init: function(configurator, blockType, $item) {\n                this.configurator = configurator;\n                this.blockType = blockType;\n                this.$item = $item;\n                this.id = this.$item.data('id');\n\n                this.inputNamePrefix = this.blockType.inputNamePrefix + '[fields][' + this.id + ']';\n                this.inputIdPrefix = this.blockType.inputIdPrefix + '-fields-' + this.id;\n\n                this.initializedFieldTypeSettings = {};\n                this.fieldTypeSettingsTemplates = {};\n\n                let $nameContainer = this.$item.children('.mci-name');\n                this.$nameLabel = $nameContainer.children('h4');\n                this.$handleLabel = $nameContainer.children('.smalltext');\n\n                // Find the field settings container if it exists, otherwise create it\n                this.$fieldSettingsContainer = this.blockType.$fieldSettingsContainer.children('[data-id=\"' + this.id + '\"]:first');\n\n                var isNew = (!this.$fieldSettingsContainer.length);\n\n                if (isNew) {\n                    this.$fieldSettingsContainer = this.getDefaultFieldSettings().appendTo(this.blockType.$fieldSettingsContainer);\n                }\n\n                this.$nameInput = $('#' + this.inputIdPrefix + '-name');\n                this.$handleInput = $('#' + this.inputIdPrefix + '-handle');\n                this.$requiredCheckbox = $('#' + this.inputIdPrefix + '-required');\n                this.$typeSelect = $('#' + this.inputIdPrefix + '-type');\n                this.$translationSettingsContainer = $('#' + this.inputIdPrefix + '-translation-settings');\n                this.$typeSettingsContainer = this.$fieldSettingsContainer.children('.fieldtype-settings:first');\n                this.$widthInput = $('#' + this.inputIdPrefix + '-width');\n                this.$deleteBtn = this.$fieldSettingsContainer.children('a.delete:first');\n\n                if (isNew) {\n                    this.setFieldType('craft\\\\fields\\\\PlainText');\n                }\n                else {\n                    this.selectedFieldType = this.$typeSelect.val();\n                    this.initializedFieldTypeSettings[this.selectedFieldType] = this.$typeSettingsContainer.children();\n                }\n\n                if (!this.$handleInput.val()) {\n                    new Craft.HandleGenerator(this.$nameInput, this.$handleInput);\n                }\n\n                this.addListener(this.$item, 'click', 'select');\n                this.addListener(this.$nameInput, 'input', 'updateNameLabel');\n                this.addListener(this.$handleInput, 'input', 'updateHandleLabel');\n                this.addListener(this.$requiredCheckbox, 'change', 'updateRequiredIcon');\n                this.addListener(this.$typeSelect, 'change', 'onTypeSelectChange');\n                this.addListener(this.$deleteBtn, 'click', 'confirmDelete');\n\n                let widthSlider = new Craft.SlidePicker(this.$widthInput.val() || 100, {\n                    min: 25,\n                    max: 100,\n                    step: 25,\n                    valueLabel: width => {\n                        return Craft.t('app', '{pct} width', {pct: `${width}%`});\n                    },\n                    onChange: width => {\n                        this.$widthInput.val(width);\n                    }\n                });\n                widthSlider.$container.insertAfter($nameContainer);\n            },\n\n            select: function() {\n                if (this.blockType.selectedField === this) {\n                    return;\n                }\n\n                if (this.blockType.selectedField) {\n                    this.blockType.selectedField.deselect();\n                }\n\n                this.configurator.$fieldSettingsColumnContainer.removeClass('hidden').trigger('resize');\n                this.blockType.$fieldSettingsContainer.removeClass('hidden');\n                this.$fieldSettingsContainer.removeClass('hidden');\n                this.$item.addClass('sel');\n                this.blockType.selectedField = this;\n\n                if (!Garnish.isMobileBrowser()) {\n                    setTimeout($.proxy(function() {\n                        this.$nameInput.trigger('focus');\n                    }, this), 100);\n                }\n            },\n\n            deselect: function() {\n                this.$item.removeClass('sel');\n                this.configurator.$fieldSettingsColumnContainer.addClass('hidden').trigger('resize');\n                this.blockType.$fieldSettingsContainer.addClass('hidden');\n                this.$fieldSettingsContainer.addClass('hidden');\n                this.blockType.selectedField = null;\n            },\n\n            updateNameLabel: function() {\n                var val = this.$nameInput.val();\n                this.$nameLabel.html((val ? Craft.escapeHtml(val) : '<em class=\"light\">' + Craft.t('app', '(blank)') + '</em>'));\n            },\n\n            updateHandleLabel: function() {\n                this.$handleLabel.html(Craft.escapeHtml(this.$handleInput.val()));\n            },\n\n            updateRequiredIcon: function() {\n                if (this.$requiredCheckbox.prop('checked')) {\n                    this.$nameLabel.addClass('mci-required');\n                }\n                else {\n                    this.$nameLabel.removeClass('mci-required');\n                }\n            },\n\n            onTypeSelectChange: function() {\n                this.setFieldType(this.$typeSelect.val());\n            },\n\n            setFieldType: function(type) {\n                // Update the Translation Method settings\n                Craft.updateTranslationMethodSettings(type, this.$translationSettingsContainer);\n\n                if (this.selectedFieldType) {\n                    this.initializedFieldTypeSettings[this.selectedFieldType].detach();\n                }\n\n                this.selectedFieldType = type;\n                this.$typeSelect.val(type);\n\n                // Show a spinner\n                this.$typeSettingsContainer.html('<div class=\"zilch\"><div class=\"spinner\"></div></div>');\n\n                this.getFieldTypeSettings(type).then(({fresh, $settings, headHtml, footHtml}) => {\n                    this.$typeSettingsContainer.html('').append($settings);\n                    if (fresh) {\n                        Craft.initUiElements($settings);\n                        Craft.appendHeadHtml(headHtml);\n                        Craft.appendFootHtml(footHtml);\n                    }\n\n                    // In case Firefox was sleeping on the job\n                    this.$typeSettingsContainer.trigger('resize');\n                }).catch(() => {\n                    this.$typeSettingsContainer.html('');\n                });\n            },\n\n            getFieldTypeSettings: function(type) {\n                return new Promise((resolve, reject) => {\n                    if (typeof this.initializedFieldTypeSettings[type] !== 'undefined') {\n                        resolve({\n                            fresh: false,\n                            $settings: this.initializedFieldTypeSettings[type],\n                        });\n                        return;\n                    }\n\n                    this.configurator.getFieldTypeSettingsHtml(type).then(({settingsHtml, headHtml, footHtml}) => {\n                        settingsHtml = this.getParsedFieldTypeHtml(settingsHtml);\n                        headHtml = this.getParsedFieldTypeHtml(headHtml);\n                        footHtml = this.getParsedFieldTypeHtml(footHtml);\n                        let $settings = $('<div/>').html(settingsHtml);\n                        this.initializedFieldTypeSettings[type] = $settings;\n                        resolve({\n                            fresh: true,\n                            $settings: $settings,\n                            headHtml: headHtml,\n                            footHtml: footHtml,\n                        });\n                    }).catch($.noop);\n                });\n            },\n\n            getParsedFieldTypeHtml: function(html) {\n                if (typeof html === 'string') {\n                    html = html.replace(/__BLOCK_TYPE__/g, this.blockType.id);\n                    html = html.replace(/__FIELD__/g, this.id);\n                }\n                else {\n                    html = '';\n                }\n\n                return html;\n            },\n\n            getDefaultFieldSettings: function() {\n                var $container = $('<div/>', {\n                    'data-id': this.id\n                });\n\n                Craft.ui.createTextField({\n                    label: Craft.t('app', 'Name'),\n                    id: this.inputIdPrefix + '-name',\n                    name: this.inputNamePrefix + '[name]'\n                }).appendTo($container);\n\n                Craft.ui.createTextField({\n                    label: Craft.t('app', 'Handle'),\n                    id: this.inputIdPrefix + '-handle',\n                    'class': 'code',\n                    name: this.inputNamePrefix + '[handle]',\n                    maxlength: 64,\n                    required: true\n                }).appendTo($container);\n\n                Craft.ui.createTextareaField({\n                    label: Craft.t('app', 'Instructions'),\n                    id: this.inputIdPrefix + '-instructions',\n                    'class': 'nicetext',\n                    name: this.inputNamePrefix + '[instructions]'\n                }).appendTo($container);\n\n                let $fieldset = $('<fieldset/>').appendTo($container);\n\n                Craft.ui.createCheckboxField({\n                    label: Craft.t('app', 'This field is required'),\n                    id: this.inputIdPrefix + '-required',\n                    name: this.inputNamePrefix + '[required]'\n                }).appendTo($fieldset);\n\n                Craft.ui.createCheckboxField({\n                    label: Craft.t('app', 'Use this field’s values as search keywords'),\n                    id: this.inputIdPrefix + '-searchable',\n                    name: this.inputNamePrefix + '[searchable]',\n                    checked: false,\n                }).appendTo($fieldset);\n\n                var fieldTypeOptions = [];\n\n                for (var i = 0; i < this.configurator.fieldTypeInfo.length; i++) {\n                    fieldTypeOptions.push({\n                        value: this.configurator.fieldTypeInfo[i].type,\n                        label: this.configurator.fieldTypeInfo[i].name\n                    });\n                }\n\n                Craft.ui.createSelectField({\n                    label: Craft.t('app', 'Field Type'),\n                    id: this.inputIdPrefix + '-type',\n                    name: this.inputNamePrefix + '[type]',\n                    options: fieldTypeOptions,\n                    value: 'craft\\\\fields\\\\PlainText'\n                }).appendTo($container);\n\n                if (Craft.isMultiSite) {\n                    var $translationSettingsContainer = $('<div/>', {\n                        id: this.inputIdPrefix + '-translation-settings'\n                    }).appendTo($container);\n\n                    Craft.ui.createSelectField({\n                        label: Craft.t('app', 'Translation Method'),\n                        id: this.inputIdPrefix + '-translation-method',\n                        name: this.inputNamePrefix + '[translationMethod]',\n                        options: [],\n                        value: 'none',\n                        toggle: true,\n                        targetPrefix: this.inputIdPrefix + '-translation-method-'\n                    }).appendTo($translationSettingsContainer);\n\n                    var $translationKeyFormatContainer = $('<div/>', {\n                        id: this.inputIdPrefix + '-translation-method-custom',\n                        'class': 'hidden'\n                    }).appendTo($translationSettingsContainer);\n\n                    Craft.ui.createTextField({\n                        label: Craft.t('app', 'Translation Key Format'),\n                        id: this.inputIdPrefix + '-translation-key-format',\n                        name: this.inputNamePrefix + '[translationKeyFormat]'\n                    }).appendTo($translationKeyFormatContainer);\n                }\n\n                $('<hr/>').appendTo($container);\n\n                $('<div/>', {\n                    'class': 'fieldtype-settings'\n                }).appendTo($container);\n\n                $('<input/>', {\n                    type: 'hidden',\n                    id: this.inputIdPrefix + '-width',\n                    name: this.inputNamePrefix + '[width]',\n                    value: '100',\n                }).appendTo($container);\n\n                $('<hr/>').appendTo($container);\n\n                $('<a/>', {\n                    'class': 'error delete',\n                    text: Craft.t('app', 'Delete')\n                }).appendTo($container);\n\n                return $container;\n            },\n\n            confirmDelete: function() {\n                if (confirm(Craft.t('app', 'Are you sure you want to delete this field?'))) {\n                    this.selfDestruct();\n                }\n            },\n\n            selfDestruct: function() {\n                this.deselect();\n                this.$item.remove();\n                this.$fieldSettingsContainer.remove();\n\n                this.blockType.fields[this.id] = null;\n                delete this.blockType.fields[this.id];\n            }\n        });\n})(jQuery);\n"]}